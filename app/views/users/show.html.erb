<div class="profile-container">
  <% @user = current_user %>
  <h4 class="name"><%= @user.first_name%> <%= @user.last_name%></h4>
  <%= @user.email %></p>
  <% if @user.avatar.present? %>
   <%= cl_image_tag user.avatar.url(:height => 150, :width => 150, :crop => :fill, :gravity => :face, :radius => 75)%>
   <% end %>
   <%= link_to "Update profile", edit_user_registration_path(@user), class: "btn-small"  %>



  <hr>

  <h4 class="profile-title">My favourites</h4>
    <div class="index-grid">
      <% my_favourites = @user.favourites %>
      <% my_favourites.each do |favourite| %>
      <% @recipe = favourite.recipe %>
        <div class="profile-card">
          <%= link_to recipe_path(favourite.recipe) do %>
          <div class="img-box-index">
            <% if favourite.recipe.photo.url %>
              <%= cl_image_tag favourite.recipe.photo, height: 150, width: 200, crop: :fill %>
            <% else %>
              <%= image_tag("recipe_default.jpg", class:"index-default") %>
            <% end %>

          </div>
          <div class="profile-card-content">
            <%= link_to recipe_path(favourite.recipe) do %>
            <h3><%= link_to favourite.recipe.name, recipe_path(favourite.recipe) %></h3>
            <div class="profile-star-box">
              <div class="card-stars">
                <% favourite.recipe.average_rating.times do%>
                  <span class="fa fa-star checked"></span>
                  <% end %>
                  <% (5 - favourite.recipe.average_rating).times do%>
                  <span class="fa fa-star empty"></span>
                <% end %>

              </div>
              <% if  current_user.commented?(favourite.recipe) %>
                <% @comment = current_user.get_comment_instances(favourite.recipe) %>
                <div class="profile-icons" id="comment-click" data-toggle="modal" data-target="#modal-<%=@comment.id%>">
                  <%= image_tag("post-it.png", class:"comment-icon") %>
                </div>

              <div class="modal fade" id="modal-<%= @comment.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-body">
                      <p>
                        <%= current_user.get_comment_instances(favourite.recipe).content  %>
                      </p>
                      <button type="button" class="btn-small" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
            </div>
            <div class="card-numbers">
              <div class="inline">
                <i class="fas fa-utensils space-right"></i>
                <p class="portions_number_original"><%= favourite.recipe.portions %></p>
              </div>
              <p><i class="fas fa-clock space-right"></i><%= favourite.recipe.time %> min</p>
            </div>
            <ul class="card-categories">
              <% favourite.recipe.categories[0..3].each do |category| %>
                <li class="index-cat">
                  <%=category.name %>
                </li>
              <% end %>
            </ul>
            <% end %>
          </div>
          <% end %>
        </div>
      <% end %>

    </div>

    <h4 class="profile-title">My recipes</h4>
    <div class="index-grid">
      <% my_recipes = @user.recipes.order('name ASC') %>
      <% my_recipes.each do |recipe| %>
        <div class="index-card">
          <%= link_to recipe_path(recipe) do %>
          <div class="img-box-index">
            <% if recipe.photo.url %>
              <%= cl_image_tag recipe.photo, height: 200, width: 200, crop: :fill %>
            <% else %>
              <%= image_tag("recipe_default.jpg", class:"index-default") %>
            <% end %>
          </div>
          <div class="index-card-content">
            <div>
              <h3><%= link_to recipe.name, recipe_path(recipe) %></h3>
            </div>
            <div>
              <div class="card-stars">
                <% recipe.average_rating.times do%>
                  <span class="fa fa-star checked"></span>
                  <% end %>
                  <% (5 - recipe.average_rating).times do%>
                  <span class="fa fa-star empty"></span>
                <% end %>
              </div>
              <div class="card-numbers">
                <div class="inline">
                  <i class="fas fa-utensils space-right"></i>
                  <p class="portions_number_original"><%= recipe.portions %></p>
                </div>
                <p><i class="fas fa-clock space-right"></i><%= recipe.time %> min</p>
              </div>
            </div>
            <div>
              <ul class="card-categories">
                <% recipe.categories[0..3].each do |category| %>
                  <li class="index-cat">
                    <%= category.name %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
          <% end %>
        </div>
      <% end %>
    <!-- </div> -->
    </div>
  <br>
  <h4 class="profile-title">My reviews</h4>
  <div class="profile-review-grid">
    <% @user.reviews.each do |review| %>
      <div class="profile-review">
        <div>
          <% @recipe = review.recipe %>
          <%= link_to recipe_path(review.recipe) do %>
            <h5><%=review.recipe.name %></h5>
            <p>"<%= review.content %>"</p>
            <% review.rating.times do%>
              <span class="fa fa-star checked"></span>
            <% end %>
            <% (5 - review.rating).times do%>
              <span class="fa fa-star empty"></span>
            <% end %>
          <% end %>
          <span class="profile-review-icons">
            <%= link_to "", edit_recipe_review_path(@recipe, review), class: "fas fa-pencil-alt opacity_7 green"%>
            <%=  link_to "", recipe_review_path(@recipe,review), method: :delete, data: { confirm: "are you sure?" }, class: "fa fa-trash opacity_7 green" %></p>
          </span>
        </div>
        <div>
          <% if review.photo?%>
            <%= cl_image_tag review.photo, height: 100, width: 100, crop: :fill  %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  <br>
  <h4 class="profile-title">My links</h4>
  <div class="profile-review-grid">
    <% @user.links.each do |link| %>
      <div class="profile-link">
      <%= link_to link.url do %>
        <h5><%= link.title %></h5>
        <p><%= link.url.first(30) %>...</p>
        <p>"<%= link.note %>"</p>
        <% if link.image? %>
          <%= cl_image_tag link.image, height: 200, width: 200, crop: :fill %>
        <% end %>
        <p>          
          <%= link_to "", edit_link_path(link), class: "fas fa-pencil-alt opacity_7 green"%>
          <%=  link_to "", link_path(link), method: :delete, data: { confirm: "are you sure?" }, class: "fa fa-trash opacity_7 green" %></p>
      <% end %>
      
      </div>
    <% end %>
  </div>
  <%= link_to "Add a new link", new_link_path, class: "btn-show btn-green" %>
</div>

 